<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Generate Synthetic Data with tidyllm • tidyllm</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Generate Synthetic Data with tidyllm">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tidyllm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.8</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/tidyllm.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/tidyllm_classifiers.html">Classifying Texts with tidyllm</a></li>
    <li><a class="dropdown-item" href="../articles/tidyllm-pdfquestions.html">Structured Question Answering from PDFs</a></li>
    <li><a class="dropdown-item" href="../articles/tidyllm-synthetic-data.html">Generate Synthetic Data with tidyllm</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/edubruell/tidyllm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Generate Synthetic Data with tidyllm</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/edubruell/tidyllm/blob/HEAD/vignettes/articles/tidyllm-synthetic-data.Rmd" class="external-link"><code>vignettes/articles/tidyllm-synthetic-data.Rmd</code></a></small>
      <div class="d-none name"><code>tidyllm-synthetic-data.Rmd</code></div>
    </div>

    
    
<p>As large language models (LLMs) evolve, their potential to simulate
human-like behavior offers an exciting opportunity for researchers in
various fields. Inspired by the work of <a href="https://arxiv.org/abs/2301.07543" class="external-link">Horton et al (2023)</a> on
running behivoural econonomics lab experiments with a “homo silicus”,
LLMs acting as computational models of humans, this article explores how
synthetic data generated from LLMs can be used to pretest survey designs
before going into the field.</p>
<p>Pretesting with synthetic data enables quick iterations on survey
questions, helping you spot potential issues early and save time during
actual data collection. For example, if you’re preparing a survey for
lawyers on automation, you can use <strong>tidyllm</strong> to simulate
survey responses based on real profiles. This allows you to write
analysis code and identify ambiguities in question phrasing or logic
flow, ensuring a smoother deployment when surveying real
participants.</p>
<p>Imagine for example that you are a researcher who just got contact
info for many lawyers you want to invite to a survey on automation,
provided by the bar association. You have already enriched this data
with information from web-based sources, such as advertising taglines
from law firm websites. Here is what such data could look like:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/edubruell/tidyllm" class="external-link">tidyllm</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://glue.tidyverse.org/" class="external-link">glue</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">lawyers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">read_rds</a></span><span class="op">(</span><span class="st">"lawyer_profiles.rds"</span><span class="op">)</span></span>
<span><span class="va">lawyers</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 495 × 9</span></span></span>
<span><span class="co">#&gt;    first_name last_name     year_bar_admission specialization  location         </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Solon      <span style="color: #949494;">"</span>Predovic<span style="color: #949494;">"</span>    2018               Criminal Law    Denver, CO       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Linzy      <span style="color: #949494;">"</span>Gleason<span style="color: #949494;">"</span>     2020               Tax Law         San Francisco, CA</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Miss Amiya <span style="color: #949494;">"</span>Braun<span style="color: #949494;">"</span>       2015               Family Law      Atlanta, GA      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Irvine     <span style="color: #949494;">"</span>Kerluke PhD<span style="color: #949494;">"</span> 2008               Corporate Law   Chicago, IL      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Marta      <span style="color: #949494;">"</span>Waelchi <span style="color: #949494;">"</span>    2012               Healthcare Law  Boston, MA       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Affie      <span style="color: #949494;">"</span>Kreiger<span style="color: #949494;">"</span>     2018               Criminal Law    Dallas, TX       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Montie     <span style="color: #949494;">"</span>Kunze<span style="color: #949494;">"</span>       2002               Tax Law         San Francisco, CA</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Marleigh   <span style="color: #949494;">"</span>Fahey<span style="color: #949494;">"</span>       2015               Family Law      Miami, FL        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Olene      <span style="color: #949494;">"</span>Stokes<span style="color: #949494;">"</span>      2012               Corporate Law   Chicago, IL      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Sonji      <span style="color: #949494;">"</span>Stark <span style="color: #949494;">"</span>      2009               Estate Planning Boston, MA       </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 485 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4 more variables: bar_admission_state &lt;chr&gt;, place_of_education &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   email &lt;chr&gt;, advertising_tagline &lt;chr&gt;</span></span></span></code></pre></div>
<p>To generate synthetic survey responses based on real profiles, we
first need to format the lawyer profiles into a human-readable prompt
that the language model can use to simulate responses. This step
involves transforming the data to create a synthetic “person” that the
model will assume when responding to the survey.</p>
<p>The following code prepares the second lawyer profile as a role for
the language model. So as a first step we get each individual profile
into list ofsingle-row tibbles that we can modify with further
functions:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">profiles</span> <span class="op">&lt;-</span> <span class="va">lawyers</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_split.html" class="external-link">group_split</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Each of these invidual profile tibbles can be prepared as a potential
input into the model prompt. Here is an example step to get the profile
for the first person in our data in a well-readable format:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">profiles</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue_data</a></span><span class="op">(</span><span class="st">"{str_replace_all(name, '_', ' ') |&gt; str_to_sentence()}: {value}"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html" class="external-link">str_c</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; First name: Solon</span></span>
<span><span class="co">#&gt; Last name: Predovic</span></span>
<span><span class="co">#&gt; Year bar admission: 2018</span></span>
<span><span class="co">#&gt; Specialization: Criminal Law</span></span>
<span><span class="co">#&gt; Location: Denver, CO</span></span>
<span><span class="co">#&gt; Bar admission state: Colorado</span></span>
<span><span class="co">#&gt; Place of education: University of Colorado Law School</span></span>
<span><span class="co">#&gt; Email: solonpredovic@co-legal.com</span></span>
<span><span class="co">#&gt; Advertising tagline: Protecting Your Rights in the Mile High City</span></span></code></pre></div>
<ul>
<li>This code uses <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer()</a></code> to convert the profile
into key-value pairs.</li>
<li>It then applies <code><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue_data()</a></code> to format each row neatly,
replacing underscores with spaces and capitalizing field names.</li>
<li>Lastly it Collapses the profile into a single string with each
attribute on a new line, which can then be used as input for the
model.</li>
</ul>
<p>With a way to get reasonable person profiles, we can put a first
questionaire flow into a function:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">generate_synthetic_study_opener</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">lawyer_profile</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co">#Get the person prompt to glue into the initial setup</span></span>
<span>  <span class="va">person_prompt</span> <span class="op">&lt;-</span> <span class="va">lawyer_profile</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace_all</a></span><span class="op">(</span><span class="va">name</span>,<span class="st">"_"</span>, <span class="st">" "</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html" class="external-link">str_to_sentence</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>           profile_row <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">name</span>, <span class="st">": "</span>, <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">profile_row</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html" class="external-link">str_c</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">#Setup an initial task and the first question     </span></span>
<span>  <span class="va">initial_setup</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">'Imagine you are this person and you are participating in </span></span>
<span><span class="st">  a survey on automation and the future of legal occupations:</span></span>
<span><span class="st">  </span></span>
<span><span class="st">  {person_prompt}</span></span>
<span><span class="st">       </span></span>
<span><span class="st">  How would you answer the following questions. </span></span>
<span><span class="st">  ONLY ANSWER WITH A VALID RESPONSE BUTTON</span></span>
<span><span class="st">  ----</span></span>
<span><span class="st">  Question 1: What gender do you identify as?</span></span>
<span><span class="st">  1 = Male</span></span>
<span><span class="st">  2 = Female</span></span>
<span><span class="st">  3 = Diverse</span></span>
<span><span class="st">  99 = Prefer not to say</span></span>
<span><span class="st">  '</span><span class="op">)</span> </span>
<span></span>
<span>  <span class="co">#Pipe the initial setup into the second and third question,</span></span>
<span>  <span class="co"># as well as model answers. </span></span>
<span>  <span class="fu"><a href="../reference/llm_message.html">llm_message</a></span><span class="op">(</span><span class="va">initial_setup</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/ollama.html">ollama</a></span><span class="op">(</span>.model <span class="op">=</span> <span class="st">"gemma2"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/llm_message.html">llm_message</a></span><span class="op">(</span><span class="st">"Question 2: What's your year of birth?</span></span>
<span><span class="st">              Answer with a four-digit number.</span></span>
<span><span class="st">              "</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/ollama.html">ollama</a></span><span class="op">(</span>.model <span class="op">=</span> <span class="st">"gemma2"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/llm_message.html">llm_message</a></span><span class="op">(</span><span class="st">"Question 3: How familiar are you with the term AI?</span></span>
<span><span class="st">              </span></span>
<span><span class="st">              1 = Not familiar at all</span></span>
<span><span class="st">              2 = Slightly familiar</span></span>
<span><span class="st">              3 = Somewhat familiar</span></span>
<span><span class="st">              4 = Moderately familiar</span></span>
<span><span class="st">              5 = Very familiar</span></span>
<span><span class="st">              </span></span>
<span><span class="st">            99 = Prefer not to say  </span></span>
<span><span class="st">              "</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/ollama.html">ollama</a></span><span class="op">(</span>.model <span class="op">=</span> <span class="st">"gemma2"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span>  </span>
<span><span class="va">profile1_questionaire</span> <span class="op">&lt;-</span> <span class="fu">generate_synthetic_study_opener</span><span class="op">(</span><span class="va">profiles</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">profile1_questionaire</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Message History:</span></span>
<span><span class="co">#&gt; system: You are a helpful assistant</span></span>
<span><span class="co">#&gt; --------------------------------------------------------------</span></span>
<span><span class="co">#&gt; user: Imagine you are this person and you are participating in </span></span>
<span><span class="co">#&gt; a survey on automation and the future of legal occupations:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; First name: Solon</span></span>
<span><span class="co">#&gt; Last name: Predovic</span></span>
<span><span class="co">#&gt; Year bar admission: 2018</span></span>
<span><span class="co">#&gt; Specialization: Criminal Law</span></span>
<span><span class="co">#&gt; Location: Denver, CO</span></span>
<span><span class="co">#&gt; Bar admission state: Colorado</span></span>
<span><span class="co">#&gt; Place of education: University of Colorado Law School</span></span>
<span><span class="co">#&gt; Email: solonpredovic@co-legal.com</span></span>
<span><span class="co">#&gt; Advertising tagline: Protecting Your Rights in the Mile High City</span></span>
<span><span class="co">#&gt;      </span></span>
<span><span class="co">#&gt; How would you answer the following questions. </span></span>
<span><span class="co">#&gt; ONLY ANSWER WITH A VALID RESPONSE BUTTON</span></span>
<span><span class="co">#&gt; ----</span></span>
<span><span class="co">#&gt; Question 1: What gender do you identify as?</span></span>
<span><span class="co">#&gt; 1 = Male</span></span>
<span><span class="co">#&gt; 2 = Female</span></span>
<span><span class="co">#&gt; 3 = Diverse</span></span>
<span><span class="co">#&gt; 99 = Prefer not to say</span></span>
<span><span class="co">#&gt; --------------------------------------------------------------</span></span>
<span><span class="co">#&gt; assistant: 1 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; --------------------------------------------------------------</span></span>
<span><span class="co">#&gt; user: Question 2: What's your year of birth?</span></span>
<span><span class="co">#&gt;               Answer with a four-digit number.</span></span>
<span><span class="co">#&gt;               </span></span>
<span><span class="co">#&gt; --------------------------------------------------------------</span></span>
<span><span class="co">#&gt; assistant: 1991</span></span>
<span><span class="co">#&gt; --------------------------------------------------------------</span></span>
<span><span class="co">#&gt; user: Question 3: How familiar are you with the term AI?</span></span>
<span><span class="co">#&gt;               </span></span>
<span><span class="co">#&gt;               1 = Not familiar at all</span></span>
<span><span class="co">#&gt;               2 = Slightly familiar</span></span>
<span><span class="co">#&gt;               3 = Somewhat familiar</span></span>
<span><span class="co">#&gt;               4 = Moderately familiar</span></span>
<span><span class="co">#&gt;               5 = Very familiar</span></span>
<span><span class="co">#&gt;               </span></span>
<span><span class="co">#&gt;             99 = Prefer not to say  </span></span>
<span><span class="co">#&gt;               </span></span>
<span><span class="co">#&gt; --------------------------------------------------------------</span></span>
<span><span class="co">#&gt; assistant: 4</span></span>
<span><span class="co">#&gt; --------------------------------------------------------------</span></span></code></pre>
<p>An easy way to get the assistant answers from this message history is
to use the <code><a href="../reference/get_reply.html">get_reply()</a></code>-function which can give you
assistant messages based on their index in the message history.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  gender      <span class="op">=</span> <span class="fu"><a href="../reference/get_reply.html">get_reply</a></span><span class="op">(</span><span class="va">profile1_questionaire</span>,<span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  birth_year  <span class="op">=</span> <span class="fu"><a href="../reference/get_reply.html">get_reply</a></span><span class="op">(</span><span class="va">profile1_questionaire</span>,<span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  ai_familiar <span class="op">=</span> <span class="fu"><a href="../reference/get_reply.html">get_reply</a></span><span class="op">(</span><span class="va">profile1_questionaire</span>,<span class="fl">3</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   gender birth_year ai_familiar</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>      1       <span style="text-decoration: underline;">1</span>991           4</span></span></code></pre></div>
<p>We could now put this into our
<code>generate_synthetic_study_opener()</code> function and directly get
the answers together with some information from the lawyer profiles we
put in. But there is still a part missing. In surveys we often want to
either have preset paths that differ (e.g. a randomized information
treatment) or questions that are only shown, when some previous answer
was chosen. Both are fairly straightforward to implement with
<strong>tidyllm</strong>.</p>
<div class="section level2">
<h2 id="implementing-an-information-treatment">Implementing an information treatment<a class="anchor" aria-label="anchor" href="#implementing-an-information-treatment"></a>
</h2>
<p>Our next step if to implement a
<code>generate_synthetic_infotreatment()</code> function that is
designed to simulate how respondents might update their answers after
receiving new information, known as an information treatment. In this
example, the treatment is based on a study that reports <a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=4414065" class="external-link">high
exposure of legal professionals to automation through generative AI</a>.
The function takes in two arguments: <code>conversation</code>, which
represents the ongoing interaction between the LLM and the questionaire
based on the responses to <code>generate_synthetic_answers()</code>, and
<code>treated</code>, a boolean flag indicating whether the respondent
receives the information treatment.</p>
<p>The function starts by retrieving the synthetic respondent’s previous
answers to key questions for output. It then provides an AI
automation-related prompt to gauge the respondent’s initial perception
of their occupation’s automatable potential (the “prior” belief). If the
respondent is in the treated group, they receive the additional
information about legal professionals’ AI exposure. After presenting
this information, the function prompts the respondent to reconsider
their initial answer, thus capturing the “posterior” belief. Finally,
the function returns both the prior and posterior beliefs along with the
respondent’s demographic information, offering insights into how the
information treatment affects perceptions of AI automation.</p>
<p>Here is how such a simplified version of such a function (without
error-handling or cleanup logic) might look like:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">generate_synthetic_infotreatment</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">conversation</span>, <span class="va">treated</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Extract key initial answers (gender, birth year, familiarity with AI)</span></span>
<span>  <span class="va">answers_opener</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    gender      <span class="op">=</span> <span class="fu"><a href="../reference/get_reply.html">get_reply</a></span><span class="op">(</span><span class="va">conversation</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    birth_year  <span class="op">=</span> <span class="fu"><a href="../reference/get_reply.html">get_reply</a></span><span class="op">(</span><span class="va">conversation</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>    ai_familiar <span class="op">=</span> <span class="fu"><a href="../reference/get_reply.html">get_reply</a></span><span class="op">(</span><span class="va">conversation</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Ask the prior belief question (before treatment)</span></span>
<span>  <span class="va">prior</span> <span class="op">&lt;-</span> <span class="va">conversation</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/llm_message.html">llm_message</a></span><span class="op">(</span><span class="st">"Among all occupations, how automatable do you think is your occupation?</span></span>
<span><span class="st">                  </span></span>
<span><span class="st">                  0 = Not Automatable </span></span>
<span><span class="st">                  1 = Among the 10 lowest percent</span></span>
<span><span class="st">                  2 = Among the 20 lowest percent</span></span>
<span><span class="st">                  3 = Among the 30 lowest percent</span></span>
<span><span class="st">                  4 = Among the 40 lowest percent</span></span>
<span><span class="st">                  5 = Right in the middle</span></span>
<span><span class="st">                  6 = Among the top 40 percent</span></span>
<span><span class="st">                  7 = Among the top 30 percent</span></span>
<span><span class="st">                  8 = Among the top 20 percent</span></span>
<span><span class="st">                  9 = Among the top 10 percent</span></span>
<span><span class="st">                  10 = At the very top</span></span>
<span><span class="st">                  99 = Prefer not to say</span></span>
<span><span class="st">                  "</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/ollama.html">ollama</a></span><span class="op">(</span>.model <span class="op">=</span> <span class="st">"gemma2"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Extract the prior answer (belief before the treatment)</span></span>
<span>  <span class="va">prior_answer</span> <span class="op">&lt;-</span> <span class="va">prior</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/last_reply.html">last_reply</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html" class="external-link">str_squish</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Default to use the conversation state of the prior answer for the untreated group</span></span>
<span>  <span class="va">post_treatment</span> <span class="op">&lt;-</span> <span class="va">prior</span></span>
<span>  </span>
<span>  <span class="co"># Initialize the info-updating variable (0 means no treatment)</span></span>
<span>  <span class="va">info_updating</span> <span class="op">&lt;-</span> <span class="st">"0"</span></span>
<span>  </span>
<span>  <span class="co"># Apply the information treatment if the treated flag is TRUE</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">treated</span><span class="op">)</span> <span class="op">{</span> </span>
<span>    <span class="va">post_treatment</span> <span class="op">&lt;-</span> <span class="va">prior</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/llm_message.html">llm_message</a></span><span class="op">(</span><span class="st">"A recent study titled *Occupational, Industry, and Geographic Exposure to Artificial Intelligence* by Ed Felten (Princeton), Manav Raj (University of Pennsylvania), and Robert Seamans (New York University) identified legal professionals, including lawyers and judges, as some of the occupations with the highest exposure to AI technologies. </span></span>
<span><span class="st"></span></span>
<span><span class="st">According to the study, legal professionals are among the top 20 among 774 occupations most exposed to generative AI, suggesting that tasks traditionally performed by lawyers, such as legal research and document review, could be increasingly automated in the coming years.</span></span>
<span><span class="st"></span></span>
<span><span class="st">Have you read this information?</span></span>
<span><span class="st">1 = YES</span></span>
<span><span class="st">2 = NO</span></span>
<span><span class="st">99 = Prefer not to say</span></span>
<span><span class="st">"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/ollama.html">ollama</a></span><span class="op">(</span>.model <span class="op">=</span> <span class="st">"gemma2"</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Update info-updating based on whether the participant confirms reading the information</span></span>
<span>    <span class="va">info_updating</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/last_reply.html">last_reply</a></span><span class="op">(</span><span class="va">post_treatment</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Ask the posterior belief question (after treatment)</span></span>
<span>  <span class="co"># Untreated ar also asked if they want to update</span></span>
<span>  <span class="va">post_treatment</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/llm_message.html">llm_message</a></span><span class="op">(</span><span class="st">"Do you want to correct your previous answer? Which of these do you pick?</span></span>
<span><span class="st">                  </span></span>
<span><span class="st">                  0 = Not Automatable </span></span>
<span><span class="st">                  1 = Among the 10 lowest percent</span></span>
<span><span class="st">                  2 = Among the 20 lowest percent</span></span>
<span><span class="st">                  3 = Among the 30 lowest percent</span></span>
<span><span class="st">                  4 = Among the 40 lowest percent</span></span>
<span><span class="st">                  5 = Right in the middle</span></span>
<span><span class="st">                  6 = Among the top 40 percent</span></span>
<span><span class="st">                  7 = Among the top 30 percent</span></span>
<span><span class="st">                  8 = Among the top 20 percent</span></span>
<span><span class="st">                  9 = Among the top 10 percent</span></span>
<span><span class="st">                  10 = At the very top</span></span>
<span><span class="st">                  99 = Prefer not to say</span></span>
<span><span class="st">                  "</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/ollama.html">ollama</a></span><span class="op">(</span>.model <span class="op">=</span> <span class="st">"gemma2"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Extract the posterior answer (belief after the treatment)</span></span>
<span>  <span class="va">posterior_answer</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/last_reply.html">last_reply</a></span><span class="op">(</span><span class="va">post_treatment</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Combine demographic data, prior and posterior beliefs, and info-updating status</span></span>
<span>  <span class="va">answers_opener</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>prior <span class="op">=</span> <span class="va">prior_answer</span>,</span>
<span>           info_updating <span class="op">=</span> <span class="va">info_updating</span>,</span>
<span>           posterior <span class="op">=</span> <span class="va">posterior_answer</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#Let's generate this treatment under the assumption that our first example lawyer was treated</span></span>
<span><span class="va">profile1_info_treatment</span> <span class="op">&lt;-</span> <span class="va">profile1_questionaire</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">generate_synthetic_infotreatment</span><span class="op">(</span>treated <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Print the result tibble</span></span>
<span><span class="va">profile1_info_treatment</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 6</span></span></span>
<span><span class="co">#&gt;   gender birth_year ai_familiar prior info_updating posterior</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> <span style="color: #949494;">"</span>1 \n<span style="color: #949494;">"</span> 1991       4           3     2             2</span></span></code></pre>
<p>Our lawyer is very familiar with AI, has a low prior on
automatibility of his occupation, choose not to read the info material
and did update his posterior downwards. Ironically, for now the only
lawyer we’ve fully “replaced” with generative AI as synthetic survey
respondent seems to believe his job is safe from automation.</p>
<p>We could now loop over the lawyer profile, make each of them answer
the survey, or add further questions. From here we have a basic setup to
generate synthetic data with <strong>tidyllm</strong></p>
</div>
<div class="section level2">
<h2 id="validity-and-limitations">Validity and Limitations<a class="anchor" aria-label="anchor" href="#validity-and-limitations"></a>
</h2>
<p>While synthetic data from LLMs offers valuable insights for
pretesting surveys, it’s important to recognize the limitations of this
approach. LLM-generated responses are approximations and might miss
nuances that come with real human respondents. For instance, the model
might not accurately reflect personal biases, experiences, or diverse
legal practices that influence real lawyers’ perspectives on
automation.</p>
<p>Additionally, as AI models are trained on vast datasets, there might
be overgeneralization, especially for niche professions we have in our
data (i.e. divorce lawyers). Therefore, while synthetic data can
streamline early iterations of survey design, it should complement, not
replace, actual human feedback during later stages of research.</p>
</div>
<div class="section level2">
<h2 id="outlook">Outlook<a class="anchor" aria-label="anchor" href="#outlook"></a>
</h2>
<p>Looking ahead, the integration of synthetic data generation with
tools like <strong>tidyllm</strong> into traditional survey workflows
offers exciting possibilities for researchers. As LLMs become more
advanced and capable of simulating nuanced human behaviors, the accuracy
of synthetic responses will likely improve. This could lead to faster,
more efficient iterations in survey design, enabling researchers to
refine questions and test hypotheses with diverse, simulated populations
before real-world deployment.</p>
<p>Moreover, future advancements may allow for greater customization of
synthetic respondents, capturing more complex demographic variables and
behavioral patterns. For instance, by enhancing the ability to simulate
specific professions, backgrounds, or even emotional states, synthetic
data could evolve into a robust tool for experimental pretesting in
fields beyond survey research, such as behavioral economics, political
polling, and educational assessment.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Eduard Brüll.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
